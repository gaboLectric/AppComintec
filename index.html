<!DOCTYPE html>
<html lang="es">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>AppComintec - Dashboard</title>
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"> <link rel="stylesheet" href="comintec-app.css">
 <link rel="stylesheet" href="estilos-comintec.css">
 <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
 <style>
    .navbar-logo-small {
        max-height: 40px; /* Adjust this value as needed */
        width: auto; /* Maintain aspect ratio */
    }
 </style>
</head>
<body>
 <nav class="navbar navbar-expand-lg navbar-light bg-light">
 <div class="container-fluid">
 <a class="navbar-brand" href="#">
 <img src="logo.png" alt="Comintec Logo" class="img-fluid navbar-logo-small" onerror="this.style.display='none'; this.onerror=null; const p = document.createElement('p'); p.textContent='Logo'; this.parentNode.appendChild(p);">
 </a>
 <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
 <span class="navbar-toggler-icon"></span>
 </button>
 <div class="collapse navbar-collapse" id="navbarNavDropdown">
 <ul class="navbar-nav me-auto mb-2 mb-lg-0">
 <li class="nav-item">
 <a class="nav-link" href="#"><i class="bi bi-house-door"></i> Panel de Control</a>
 </li>
 <li class="nav-item dropdown">
 <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownVentas" role="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-bar-chart"></i> Ventas</a>
 <ul class="dropdown-menu" aria-labelledby="navbarDropdownVentas" data-bs-popper="static">
 <li><a class="dropdown-item" href="#">Agregar Cliente</a></li>
 <li><a class="dropdown-item" href="#">Mis Clientes</a></li>
 <li><a class="dropdown-item" href="#">Borrador de Cotizacion</a></li>
 <li><a class="dropdown-item" href="#">Existencias de Productos</a></li>
 <li><a class="dropdown-item" href="#">Asignacion de Clientes</a></li>
 <li><a class="dropdown-item" href="#">Fichas Tecnicas</a></li>
 </ul>
 </li>
 <li class="nav-item"><a class="nav-link" href="#"><i class="bi bi-box"></i> Inventario</a></li>
 <li class="nav-item dropdown">
 <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownAdministracion" role="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-sliders"></i> Administraci√≥n</a>
 <ul class="dropdown-menu" aria-labelledby="navbarDropdownAdministracion" data-bs-popper="static">
 <li><a class="dropdown-item" href="#">Solicitud de Viaticos</a></li>
 <li><a class="dropdown-item" href="solicitud_material.html">Solicitud de Material</a></li>
 <li><a class="dropdown-item" href="#">Solicitud de Tiempo</a></li>
 <li><a class="dropdown-item" href="#">Solicitud de Material</a></li>
 <li><a class="dropdown-item" href="#">Solicitud de Paqueteria</a></li>
 <li><a class="dropdown-item" href="#">Asigna Numero Fiscal</a></li>
 <li><a class="dropdown-item" href="#">Mis Solicitudes</a></li>
 <li><a class="dropdown-item" href="#">Contratos Repse</a></li>
 </ul>
 </li>
 <li class="nav-item"><a class="nav-link" href="#"><i class="bi bi-cart"></i> Compras</a></li>
 <li class="nav-item"><a class="nav-link" href="#"><i class="bi bi-tools"></i> Servicio</a></li>
 <li class="nav-item"><a class="nav-link" href="#"><i class="bi bi-scale"></i> Metrolog√≠a</a></li>
 <li class="nav-item"><a class="nav-link" href="#"><i class="bi bi-file-earmark-text"></i> Informes</a></li>
 <li class="nav-item"><a class="nav-link" href="#"><i class="bi bi-laptop"></i> Sistemas</a></li>
 <li class="nav-item"><a class="nav-link" href="#"><i class="bi bi-megaphone"></i> Marketing</a></li>
 <li class="nav-item"><a class="nav-link" href="#"><i class="bi bi-check-circle"></i> Calidad</a></li>
 <li class="nav-item"><a class="nav-link" href="#"><i class="bi bi-people"></i> Clientes</a></li>
 <li class="nav-item"><a class="nav-link" href="#"><i class="bi bi-gear"></i> Configuraci√≥n</a></li>
 </ul>
 </div>
        <div class="user-profile d-flex ms-auto">
            <img src="profile.png" alt="User Profile" class="rounded-full" onerror="this.style.display='none'; this.onerror=null; const i = document.createElement('i'); i.className='bi bi-person-circle h2'; this.parentNode.insertBefore(i, this.nextSibling);">
            <span>Nombre Usuario</span>
        </div>
    </nav>
    <div class="main-content container-fluid mt-4">
        <div class="row">
            <!-- Left Column -->
            <div class="col-lg-7">
                <div class="comintec-card mb-4">
                    <h4>Nuevos Clientes</h4> 
                    <p>5</p>
                </div>
                <div class="calendar-container comintec-card p-3 mb-4">
                    <div class="calendar-section-header">
                        <h1>Calendario</h1>
                        <p>Hoy es: <span id="display-current-date" class="current-date"></span></p>
                    </div>
                    <div class="calendar-header">
                        <button class="nav-button" id="g-prev-month">&lt;</button>
                        <h3 id="g-month-year"></h3>
                        <button class="nav-button" id="g-next-month">&gt;</button>
                    </div>
                    <div class="grid-calendar">
                        <div class="weekdays">
                            <span>Dom</span><span>Lun</span><span>Mar</span><span>Mi√©</span><span>Jue</span><span>Vie</span><span>S√°b</span>
                        </div>
                        <div class="days-grid" id="grid-calendar-days"></div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="col-lg-5">
                <div class="comintec-card mb-4">
                    <h4>Tareas Pendientes</h4>
                    <p>3</p>
                </div>
                <div class="recent-activity comintec-card p-3 mb-4">
                    <h4>Actividad Reciente</h4>
                    <ul>
                        <li>Usuario X complet√≥ la tarea Y.</li>
                        <li>Nueva venta registrada: #12345.</li>
                    </ul>
                </div>
            </div>
        </div>

        <section class="workchain-section mt-4">
            <header class="mb-5 text-center">
                <h1 class="display-4 fw-bold text-dark">Panel de Estado de √Åreas</h1>
                <p class="text-muted mt-2">Selecciona el estado para cada √°rea de trabajo.</p>
            </header>

            <div class="controls-container mx-auto" style="max-width: 28rem;">
                <div id="lock-feature-container" class="d-none">
                    <button id="lock-workflow-button" class="btn"></button>
                </div>
            </div>

            <main>
                <div id="workflow-container" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5 g-4 mb-5">
                </div>
            </main>

            <script>
                const areasConfig = {
                    'home': { name: 'Home' }, 'almacen': { name: 'Almac√©n' }, 'administracion': { name: 'Administraci√≥n' },
                    'compras': { name: 'Compras' }, 'ventas': { name: 'Ventas' }, 'servicio': { name: 'Servicio' },
                    'metrologia': { name: 'Metrolog√≠a' }, 'informes': { name: 'Informes' }, 'sistemas': { name: 'Sistemas' },
                    'marketing': { name: 'Marketing' }, 'calidad': { name: 'Calidad' }
                };

                const statusKeys = { PENDING: 'pending', REVIEW: 'review', COMPLETED: 'completed' };
                const defaultStatus = statusKeys.PENDING;
                let isWorkflowLocked = false;
                const fixedThemeKey = 'progress';

                const fixedThemeConfig = {
                    name: 'Barras de Progreso e Iconos',
                    getCardContent: (areaId, areaData, statusKey) => {
                        const progressValues = { [statusKeys.PENDING]: 10, [statusKeys.REVIEW]: 50, [statusKeys.COMPLETED]: 100 };
                        const bsProgressColors = { [statusKeys.PENDING]: 'bg-info', [statusKeys.REVIEW]: 'bg-warning', [statusKeys.COMPLETED]: 'bg-success' };
                        const icons = { [statusKeys.PENDING]: '‚è≥', [statusKeys.REVIEW]: 'üîç', [statusKeys.COMPLETED]: '‚úÖ' };
                        return `
                            <div class="fs-4 text-center mb-2">${icons[statusKey] || ''}</div>
                            <div class="progress" style="height: 10px;">
                                <div class="progress-bar ${bsProgressColors[statusKey]}" role="progressbar" style="width: ${progressValues[statusKey]}%;" aria-valuenow="${progressValues[statusKey]}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>`;
                    },
                    statusProperties: { 
                        [statusKeys.PENDING]: { label: 'Pendiente', areaClasses: ['border-info'], btnClasses: ['btn', 'btn-sm', 'btn-info'] },
                        [statusKeys.REVIEW]: { label: 'Revisi√≥n', areaClasses: ['border-warning'], btnClasses: ['btn', 'btn-sm', 'btn-warning'] },
                        [statusKeys.COMPLETED]: { label: 'Completado', areaClasses: ['border-success'], btnClasses: ['btn', 'btn-sm', 'btn-success'] }
                    }
                };

                const lockIcons = {
                    locked: `<i class="bi bi-lock-fill me-2"></i> Desbloquear Flujo`,
                    unlocked: `<i class="bi bi-unlock-fill me-2"></i> Bloquear Flujo`
                };

                function initializeAndRenderWorkflow() {
                    const container = document.getElementById('workflow-container');
                    container.innerHTML = '';

                    Object.keys(areasConfig).forEach(areaId => {
                        const areaData = areasConfig[areaId];
                        
                        const colWrapper = document.createElement('div');
                        colWrapper.className = 'col';

                        const areaEl = document.createElement('div');
                        areaEl.id = areaId;
                        areaEl.dataset.id = areaId;
                        areaEl.className = 'card h-100'; 
                        
                        const cardBody = document.createElement('div');
                        cardBody.className = 'card-body d-flex flex-column';
                        
                        const dynamicContentEl = document.createElement('div');
                        dynamicContentEl.className = 'theme-specific-content mb-3';
                        cardBody.appendChild(dynamicContentEl);

                        const titleEl = document.createElement('h3');
                        titleEl.className = 'card-title h5 text-center mb-2'; 
                        titleEl.textContent = areaData.name;
                        cardBody.appendChild(titleEl);

                        const statusButtonsContainer = document.createElement('div');
                        statusButtonsContainer.className = 'd-flex flex-wrap justify-content-center align-items-center gap-1 mt-auto pt-2 border-top';

                        Object.keys(statusKeys).forEach(key => {
                            const statusVal = statusKeys[key];
                            const statusInfo = fixedThemeConfig.statusProperties[statusVal];
                            const buttonEl = document.createElement('button');
                            buttonEl.className = `${statusInfo.btnClasses.join(' ')}`; 
                            buttonEl.textContent = statusInfo.label;
                            buttonEl.dataset.statusKey = statusVal;
                            buttonEl.onclick = () => changeAreaState(areaId, statusVal);
                            statusButtonsContainer.appendChild(buttonEl);
                        });
                        
                        cardBody.appendChild(statusButtonsContainer);
                        areaEl.appendChild(cardBody);
                        colWrapper.appendChild(areaEl);
                        container.appendChild(colWrapper);
                        
                        const savedStatus = localStorage.getItem(`areaState_${areaId}`) || defaultStatus;
                        setAreaState(areaId, savedStatus);
                    });
                    updateLockFeatureVisibilityAndState();
                }

                function changeAreaState(areaId, newStatusKey) {
                    if (isWorkflowLocked) {
                        console.log("Workflow is locked. Cannot change state.");
                        return;
                    }
                    setAreaState(areaId, newStatusKey);
                    localStorage.setItem(`areaState_${areaId}`, newStatusKey);
                    updateLockFeatureVisibilityAndState();
                }

                function setAreaState(areaId, statusKey) {
                    const areaEl = document.getElementById(areaId);
                    if (!areaEl) return;

                    areaEl.dataset.currentStatus = statusKey;
                    const statusInfo = fixedThemeConfig.statusProperties[statusKey] || fixedThemeConfig.statusProperties[defaultStatus];

                    Object.values(fixedThemeConfig.statusProperties).forEach(s => {
                        s.areaClasses.forEach(cls => areaEl.classList.remove(cls));
                    });
                    areaEl.classList.add('border');
                    statusInfo.areaClasses.forEach(cls => areaEl.classList.add(cls));

                    const dynamicContentEl = areaEl.querySelector('.theme-specific-content');
                    if (dynamicContentEl) {
                        dynamicContentEl.innerHTML = fixedThemeConfig.getCardContent(areaId, areasConfig[areaId], statusKey);
                    }
                    
                    const statusButtons = areaEl.querySelectorAll('.status-button');
                    statusButtons.forEach(btn => {
                        btn.disabled = isWorkflowLocked;
                        if (btn.dataset.statusKey === statusKey) {
                            btn.classList.add('active-status');
                        } else {
                            btn.classList.remove('active-status');
                        }
                    });
                }

                function updateLockFeatureVisibilityAndState() {
                    const lockFeatureContainer = document.getElementById('lock-feature-container');
                    const lockButton = document.getElementById('lock-workflow-button');
                    let allCompleted = true;
                    document.querySelectorAll('#workflow-container .card').forEach(card => {
                        if (card.dataset.currentStatus !== statusKeys.COMPLETED) {
                            allCompleted = false;
                        }
                    });

                    if (allCompleted) {
                        lockFeatureContainer.classList.remove('d-none');
                        lockButton.innerHTML = isWorkflowLocked ? lockIcons.locked : lockIcons.unlocked;
                        lockButton.className = `btn ${isWorkflowLocked ? 'btn-danger' : 'btn-primary'} d-flex align-items-center justify-content-center`;
                    } else {
                        lockFeatureContainer.classList.add('d-none');
                        if (isWorkflowLocked) {
                            isWorkflowLocked = false;
                            localStorage.setItem('workflowLocked', 'false');
                        }
                    }
                    updateAllCardControlsLockState();
                }
                
                function toggleWorkflowLock() {
                    isWorkflowLocked = !isWorkflowLocked;
                    localStorage.setItem('workflowLocked', isWorkflowLocked.toString());
                    updateLockFeatureVisibilityAndState();
                }

                function updateAllCardControlsLockState() {
                    document.querySelectorAll('#workflow-container .card .status-button').forEach(button => {
                        button.disabled = isWorkflowLocked;
                    });
                }
                
                document.addEventListener('DOMContentLoaded', () => {
                    const lockButton = document.getElementById('lock-workflow-button');
                    isWorkflowLocked = localStorage.getItem('workflowLocked') === 'true';
                    initializeAndRenderWorkflow();
                    lockButton.addEventListener('click', toggleWorkflowLock);
                });
            </script>
        </section>

        <section id="sales-details-section" class="mt-4">
            <h3 id="selected-day-heading">Ventas del D√≠a: --</h3>
            <div id="sales-summary">
                <h4>Resumen del D√≠a</h4>
                <p>Total Ventas: <span id="summary-total-ventas">--</span> MXN</p>
                <p>N√∫mero de Transacciones: <span id="summary-num-transacciones">--</span></p>
            </div>
            <h4>Detalle de Ventas</h4>
            <table id="sales-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Categor√≠a</th>
                        <th>Producto</th>
                        <th>Cantidad</th>
                        <th>Precio Unitario</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody id="sales-table-body">
                    <tr>
                        <td colspan="6" style="text-align:center;">Seleccione un d√≠a para ver las ventas.</td>
                    </tr>
                </tbody>
            </table>
        </section>
    </div>

    <script>
        const hoy = new Date();
        const nombresMeses = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
        const nombresDias = ["Domingo", "Lunes", "Martes", "Mi√©rcoles", "Jueves", "Viernes", "S√°bado"];

        document.getElementById('display-current-date').textContent = `${nombresDias[hoy.getDay()]}, ${hoy.getDate()} de ${nombresMeses[hoy.getMonth()]} de ${hoy.getFullYear()}`;

        function esMismoDia(fecha1, fecha2) {
            return fecha1.getFullYear() === fecha2.getFullYear() &&
                   fecha1.getMonth() === fecha2.getMonth() &&
                   fecha1.getDate() === fecha2.getDate();
        }
        
        let gFechaActual = new Date(hoy);
        let fechaSeleccionada = new Date(hoy);

        function actualizarResumenVentas(fecha) {
            const heading = document.getElementById('selected-day-heading');
            const totalVentas = document.getElementById('summary-total-ventas');
            const numTransacciones = document.getElementById('summary-num-transacciones');
            const tablaVentas = document.getElementById('sales-table-body');

            const fechaFormateada = `${nombresDias[fecha.getDay()]}, ${fecha.getDate()} de ${nombresMeses[fecha.getMonth()]} de ${fecha.getFullYear()}`;
            heading.textContent = `Ventas del D√≠a: ${fechaFormateada}`;

            const ventasEjemplo = [
                { id: 1, categoria: 'Electr√≥nicos', producto: 'Laptop', cantidad: 2, precioUnitario: 15000, total: 30000 },
                { id: 2, categoria: 'Accesorios', producto: 'Mouse', cantidad: 5, precioUnitario: 500, total: 2500 }
            ];

            const total = ventasEjemplo.reduce((sum, venta) => sum + venta.total, 0);
            totalVentas.textContent = total.toLocaleString('es-MX', { style: 'currency', currency: 'MXN' });
            numTransacciones.textContent = ventasEjemplo.length;

            tablaVentas.innerHTML = ventasEjemplo.map(venta => `
                <tr>
                    <td>${venta.id}</td>
                    <td>${venta.categoria}</td>
                    <td>${venta.producto}</td>
                    <td>${venta.cantidad}</td>
                    <td>${venta.precioUnitario.toLocaleString('es-MX', { style: 'currency', currency: 'MXN' })}</td>
                    <td>${venta.total.toLocaleString('es-MX', { style: 'currency', currency: 'MXN' })}</td>
                </tr>
            `).join('');
        }

        function renderGridCalendar() {
            const diasGridContainer = document.getElementById('grid-calendar-days');
            document.getElementById('g-month-year').textContent = `${nombresMeses[gFechaActual.getMonth()]} ${gFechaActual.getFullYear()}`;
            diasGridContainer.innerHTML = '';

            const primerDiaDelMes = new Date(gFechaActual.getFullYear(), gFechaActual.getMonth(), 1);
            const ultimoDiaDelMes = new Date(gFechaActual.getFullYear(), gFechaActual.getMonth() + 1, 0);
            
            const diaInicioSemana = primerDiaDelMes.getDay(); 

            for (let i = 0; i < diaInicioSemana; i++) {
                const diaEl = document.createElement('div');
                diaEl.classList.add('day-cell', 'other-month');
                diasGridContainer.appendChild(diaEl);
            }

            for (let i = 1; i <= ultimoDiaDelMes.getDate(); i++) {
                const diaActualLoop = new Date(gFechaActual.getFullYear(), gFechaActual.getMonth(), i);
                const diaEl = document.createElement('div');
                diaEl.classList.add('day-cell');
                diaEl.textContent = i;
                
                if (esMismoDia(diaActualLoop, hoy)) {
                    diaEl.classList.add('is-today');
                }

                if (esMismoDia(diaActualLoop, fechaSeleccionada)) {
                    diaEl.classList.add('selected');
                }

                diaEl.addEventListener('click', () => {
                    document.querySelectorAll('.day-cell').forEach(cell => {
                        cell.classList.remove('selected');
                    });
                    diaEl.classList.add('selected');
                    fechaSeleccionada = new Date(gFechaActual.getFullYear(), gFechaActual.getMonth(), i);
                    actualizarResumenVentas(fechaSeleccionada);
                });

                diasGridContainer.appendChild(diaEl);
            }

            const totalCeldasRellenas = diaInicioSemana + ultimoDiaDelMes.getDate();
            const celdasRestantesParaCompletarGrid = (7 - (totalCeldasRellenas % 7)) % 7; 

            for (let i = 0; i < celdasRestantesParaCompletarGrid; i++) {
                const diaEl = document.createElement('div');
                diaEl.classList.add('day-cell', 'other-month');
                diasGridContainer.appendChild(diaEl);
            }
        }

        document.getElementById('g-prev-month').addEventListener('click', () => {
            gFechaActual.setMonth(gFechaActual.getMonth() - 1);
            renderGridCalendar();
        });

        document.getElementById('g-next-month').addEventListener('click', () => {
            gFechaActual.setMonth(gFechaActual.getMonth() + 1);
            renderGridCalendar();
        });

        document.addEventListener('DOMContentLoaded', () => {
            renderGridCalendar();
            actualizarResumenVentas(fechaSeleccionada);
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>